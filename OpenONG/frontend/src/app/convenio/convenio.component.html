<section>
    <mat-progress-bar [mode]="progressBarMode">
    </mat-progress-bar>
</section>

<div fxLayout="column" class="components-container-gt-xs" [ngClass.xs]="'components-container-xs'" fxLayoutGap="20px">
    <div fxFlex class="input-component-holder mat-elevation-z4">
        <app-form-header *ngIf="isAddMode" titulo="Cadastrar Convênio" [rota]="['./list']" icone="list">
        </app-form-header>
        <app-form-header *ngIf="!isAddMode" titulo="Editar Convênio" [rota]="['../../list']" icone="arrow_back">
        </app-form-header>
        <div class="input-container">
            <form method="post" (ngSubmit)="addOrUpdate()">

                <div *ngIf="!isAddMode" fxLayout="row" fxLayout.lt-sm="column" fxLayoutGap="20px">
                    <div fxFlex.xs="100" fxFlex.lg="50" fxFlex.md="50" fxFlex.sm="50">
                        <table cellspacing="6">
                            <tr>
                                <td>
                                    <mat-form-field>
                                        <input disabled [(ngModel)]="convenio.id" type="text" id="id" name="id" class="form-control" matInput placeholder="Código" />
                                    </mat-form-field>
                                </td>
                                <td>
                                    <mat-checkbox [(ngModel)]="convenio.status" id="status" name="status">Ativo
                                    </mat-checkbox>
                                </td>
                            </tr>
                        </table>
                    </div>
                    <div fxFlex.xs="100" fxFlex.lg="50" fxFlex.md="50" fxFlex.sm="50">
                        <table cellspacing="6">
                            <tr>
                                <td>
                                    <mat-form-field>
                                        <input disabled [(ngModel)]="convenio.usuarioCriacao.nome" type="text" id="uscNome" name="uscNome" class="form-control" matInput placeholder="Usuário de criação" />
                                    </mat-form-field>
                                </td>
                                <td>
                                    <mat-form-field>
                                        <input disabled [(ngModel)]="convenio.usuarioModificacao.nome" type="text" id="usmNome" name="usmNome" class="form-control" matInput placeholder="Último usuário a modificar" />
                                    </mat-form-field>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>

                <div fxLayout="row" fxLayout.lt-sm="column" fxLayoutGap="20px">
                    <div fxFlex.xs="100" fxFlex.lg="50" fxFlex.md="50" fxFlex.sm="50">
                        <table cellspacing="6">
                            <tr>
                                <td>
                                    <mat-form-field>
                                        <input [(ngModel)]="convenio.nome" type="text" id="nome" name="nome" class="form-control" matInput placeholder="Nome" [formControl]="nomeFormControl" [errorStateMatcher]="matcher" required />
                                        <mat-error *ngIf="nomeFormControl.hasError('required')">
                                            O nome é <strong>obrigatório</strong>
                                        </mat-error>
                                    </mat-form-field>
                                </td>
                                <td>
                                    <mat-form-field class="width">
                                        <input (ngModelChange)="onChangeParceiro($event)" [(ngModel)]="convenio.parceiroDeNegocio.nome" matInput placeholder="Doador" aria-label="ParceiroDeNegocio" [matAutocomplete]="auto" [formControl]="parceiroDeNegocioControl" required>
                                        <mat-autocomplete #auto="matAutocomplete">
                                            <mat-option *ngFor="let pn of parceiroDeNegociosFiltradas | async" [value]="pn.nome">
                                                <span>{{ pn.nome }}</span>
                                            </mat-option>
                                        </mat-autocomplete>
                                        <mat-error *ngIf="parceiroDeNegocioControl.hasError('required')">
                                            O Doador conveniado é <strong>obrigatório</strong>
                                        </mat-error>
                                    </mat-form-field>
                                    <input hidden [(ngModel)]="convenio.parceiroDeNegocio.id" type="text" id="idCat" name="idCat" class="form-control" matInput placeholder="Id parceiroDeNegocio" />
                                </td>

                            </tr>
                        </table>
                    </div>
                    <div fxFlex.xs="100" fxFlex.lg="50" fxFlex.md="50" fxFlex.sm="50">
                        <table cellspacing="6">
                            <tr>
                                <td>
                                    <mat-form-field>
                                        <input [(ngModel)]="convenio.validoDe" id="valDe" name="valDe" matInput [matDatepicker]="dp3" placeholder="Válido de" disabled>

                                        <mat-datepicker-toggle matSuffix [for]="dp3"></mat-datepicker-toggle>
                                        <mat-datepicker #dp3 disabled="false"></mat-datepicker>
                                    </mat-form-field>
                                </td>
                                <td>
                                    <mat-form-field>
                                        <input [(ngModel)]="convenio.validoAte" id="valAte" name="valAte" matInput [matDatepicker]="dp4" placeholder="Válido até" disabled>

                                        <mat-datepicker-toggle matSuffix [for]="dp4"></mat-datepicker-toggle>
                                        <mat-datepicker #dp4 disabled="false"></mat-datepicker>
                                    </mat-form-field>

                                </td>
                            </tr>
                        </table>
                    </div>
                </div>

                <div fxLayout="row" fxLayout.lt-sm="column" fxLayoutGap="20px">
                    <div fxFlex.xs="100" fxFlex.lg="50" fxFlex.md="50" fxFlex.sm="50">
                        <table cellspacing="6">
                            <tr>
                                <td>
                                    <mat-form-field>
                                        <textarea [(ngModel)]="convenio.observacoes" id="observacoes" name="observacoes" matInput placeholder="Observações" matTextareaAutosize matAutosizeMinRows="1" matAutosizeMaxRows="5"></textarea>
                                    </mat-form-field>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>

                <div fxLayout="row" fxLayout.lt-sm="column" fxLayoutGap="20px">
                    <div fxFlex.xs="100" fxFlex.lg="50" fxFlex.md="50" fxFlex.sm="50">
                        <table cellspacing="6">
                            <tr>
                                <td>
                                    <mat-form-field class="width">
                                        <input (ngModelChange)="onChangeCategoria($event)" [(ngModel)]="convenioCategoria.categoria.nome" id="cat" name="cat" matInput placeholder="Categoria de item/serviço" aria-label="Categoria" [matAutocomplete]="auto">
                                        <mat-autocomplete #auto="matAutocomplete">
                                            <mat-option *ngFor="let pn of categoriasFiltradas | async" [value]="pn.nome">
                                                <span>{{ pn.nome }}</span>
                                            </mat-option>
                                        </mat-autocomplete>
                                    </mat-form-field>
                                    <input hidden [(ngModel)]="convenioCategoria.categoria.id" type="text" id="idCat" name="idCat" class="form-control" matInput placeholder="Id parceiroDeNegocio" />
                                </td>
                                <td>
                                    <td>
                                        <mat-form-field>
                                            <input [(ngModel)]="convenioCategoria.percentual" id="percentual" name="percentual" class="form-control" matInput placeholder="Percentual" />
                                        </mat-form-field>
                                    </td>
                                    <td>
                                        <button type="button" mat-raised-button (click)="addLinha()">Salvar Linha</button>
                                    </td>
                            </tr>
                        </table>
                    </div>
                </div>

                <mat-table #table [dataSource]="dataSource" style="margin-top: 20px;">

                    <ng-container matColumnDef="ID">
                        <mat-header-cell *matHeaderCellDef> ID </mat-header-cell>
                        <mat-cell *matCellDef="let row"> {{row.linha}} </mat-cell>
                    </ng-container>

                    <ng-container matColumnDef="Categoria">
                        <mat-header-cell *matHeaderCellDef> Categoria </mat-header-cell>
                        <mat-cell *matCellDef="let row"> {{row.categoria.nome}} </mat-cell>
                    </ng-container>

                    <ng-container matColumnDef="Percentual">
                        <mat-header-cell *matHeaderCellDef> Percentual </mat-header-cell>
                        <mat-cell *matCellDef="let row"> {{row.percentual}} </mat-cell>
                    </ng-container>

                    <ng-container matColumnDef="Editar">
                        <mat-header-cell *matHeaderCellDef> Editar </mat-header-cell>
                        <mat-cell *matCellDef="let row">
                            <button type="button" mat-button>
                                <mat-icon aria-label="Editar">edit</mat-icon>
                            </button>
                        </mat-cell>
                    </ng-container>

                    <ng-container matColumnDef="Remover">
                        <mat-header-cell *matHeaderCellDef> Remover </mat-header-cell>
                        <mat-cell *matCellDef="let row">
                            <button type="button" mat-button>
                                    <mat-icon aria-label="Remover">remove_circle</mat-icon>
                                </button>
                        </mat-cell>
                    </ng-container>

                    <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
                    <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
                </mat-table>


                <div fxLayout="row" fxLayout.lt-sm="column" fxLayoutGap="20px">
                    <table class="example-full-width" cellspacing="6">
                        <tr>
                            <td>
                                <button [disabled]="!saving" type="submit" mat-raised-button color="accent">Salvar</button>
                            </td>
                        </tr>
                    </table>
                </div>
            </form>
        </div>
    </div>
</div>